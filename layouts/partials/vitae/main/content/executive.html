{{- $pp := . }}
{{- $page := .Page }}
{{- $templateName := "executive" }}
{{- $template := printf "vitae/main/content/%s" $templateName }}

{{ partial "html-comment" (printf "BEGIN '%s'" $template) }}

{{- $vitaeTemplate := $pp.VitaeTemplate }}
{{- $vitaeData := $pp.VitaeData }}
{{- $vitaeStyle := $pp.VitaeStyle }}

{{- $debug := false }}
{{- $debug = or $debug (not (not (findRE `^/([^/]+-demo/)?devel` $page.RelPermalink) ) ) -}}
{{- $useStyleMerged := and true $debug }}
{{- $validStyles := (dict
  "ats" (dict
    "ANY_BOOL" true
  )
  "inline_separator" (dict
    "ANY_STRING" true
  )
  "role_header_separator" (dict
    "ANY_STRING" true
  )
  "stage_meta_separator" (dict
    "ANY_STRING" true
  )
  "layout" (dict
    "shallow" "shallow"
    "narrow" "narrow"
    "inline" "inline"
  )
  "display" (dict
    "grid" "grid"
  )
  "timeline" (dict
    "false" false
    "true" "column"
  )
  "heading" (dict
    "normal" "normal"
    "larger-1" "larger-1"
    "larger-2" "larger-2"
  )
  "logo" (dict
    "false" false
    "true" "left"
    "left" "left"
  )
) -}}

{{- $mergedStyle := partial "vitae/_functions/style-class" (dict
  "Style" $vitaeStyle
  "ValidStyles" $validStyles
  "Template" $template
) -}}
{{- if $debug }}
  {{- warnf "%s[%s]: After style-class:\nmergedStyle=%v" $page $template
      (jsonify (dict "indent" "  ") $mergedStyle) }}
{{- end }}
{{- $style := $mergedStyle.Style }}
{{- $styleClassList := $mergedStyle.StyleClass }}


{{- $mergedStyleNew := false }}
{{- if $useStyleMerged }}
  {{- $validStylesNew := (dict
    "ats" "ANY_BOOL"
    "inline_separator" "ANY_STRING"
    "role_header_separator" "ANY_STRING"
    "stage_meta_separator" "ANY_STRING"
    "layout" (slice "shallow" "narrow" "inline")
    "display" (dict
      "grid" "grid"
    )
    "timeline" (dict
      "false" false
      "true" "column"
    )
    "heading" (dict
      "normal" "normal"
      "larger-1" "larger-1"
      "larger-2" "larger-2"
    )
    "logo" (dict
      "false" false
      "true" "left"
      "left" "left"
    )
  ) -}}

  {{- $mergedStyleNew = partial "vitae/_functions/style-merged" (dict
    "Style" $vitaeStyle
    "ValidStyles" $validStylesNew
    "Template" $template
  ) -}}
  {{- if $debug }}
    {{- warnf "%s[%s]: vitaeStyle=%v\nvalidStylesNew=%v\n\nAfter style-merged:\nmergedStyle=%v\nmergedStyleNew=%v" $page $template
        (jsonify (dict "indent" "  ") $vitaeStyle)
        (jsonify (dict "indent" "  ") $validStylesNew)
        (jsonify (dict "indent" "  ") $mergedStyle)
        (jsonify (dict "indent" "  ") $mergedStyleNew) -}}
    {{/* {{- warnf "%s[%s]: After style-merged:\nmergedStyle=%v\nmergedStyleNew=%v" $page $template
        (jsonify (dict "indent" "  ") (merge $mergedStyle (dict "ValidStyles" "OMITTED")))
        (jsonify (dict "indent" "  ") (merge $mergedStyleNew (dict "ValidStyles" "OMITTED"))) -}} */}}
  {{- end }}
  {{- $style = $mergedStyle.Style }}
  {{- $styleClassList = $mergedStyle.StyleClass }}
{{- end }}


<!-- Pagination
Part: an independent section of one or more printed pages
PaginationPage: a printed page that is part of a Part
-->
{{- range $partIndex, $part := where $vitaeTemplate.parts "enabled" "ne" false }}
  <!-- Initially, all content is placed within one Pagination Page
  When rendering the print preview with `print-view.js`,
  this DOM node is cloned and the content is distributed across as many
  clones as required -->
  {{- $partClassList := append $styleClassList (slice
      (printf "template_%s" $part.template)
      (printf "%s%d" $pp.PartClassPrefix $partIndex)
      $pp.PaginationPageClass
    ) -}}

  {{- $partSlots := slice }}
  {{- range $slotIndex, $slotParams := $part.slots }}
    {{- $slot := false }}
    {{- $slotName := $slotParams.slot }}
    {{- with $slotParams.sections }}
      {{- $slot = $slotParams }}
    {{- else }}
      {{- if not $style.ats }}
        {{- with $vitaeTemplate.shared }}
          {{- with index . $slotParams.shared }}
            {{- $slot = . }}
            {{/* {{- warnf "%s[%s]: vitaeTemplate.shared.%v=%v" $page $template $slotParams.shared $vitaeTemplate.shared }} */}}
          {{- end }}
        {{- end }}
      {{- end }}
    {{- end }}
    {{- with $slot }}
      {{- with $slot.pagination_container_class }}
        {{- $partClassList = append . $partClassList }}
      {{- end }}
      {{- $slot = merge $slot (dict "slot" $slotName) }}
      {{- $partSlots = append $slot $partSlots }}
    {{- end }}
  {{- end }}

  <div class="{{ delimit $partClassList ` `}}">
    {{- range $slotIndex, $slot := $partSlots }}
      {{/* {{- partial "html-comment" (printf "[%s]: slot[%T] name=%s:\n%v"
          $template $slot $slot.slot (jsonify (dict "indent" "  ") $slot) ) }} */}}
      {{/* {{- warnf "%s[%s]: slot=%v" $page $template $slot.slot }} */}}
      {{/* {{- warnf "%s[%s]: shared=%v" $page $template $slot.shared }} */}}
      {{- $paginationPolicy := $slot.pagination_policy | default $part.pagination_policy | default `break` }}
      {{- $paginationOrder := $slot.pagination_order | default $slotIndex }}
      {{- $container := default "div" .container }}
      {{- with $container }}
        {{- $containerClass := slice (printf "slot_%s" $slot.slot) $pp.PaginationContainerClass }}
        {{- with $slot.container_class }}
          {{- $containerClass = append . $containerClass }}
        {{- end }}
        {{- $mergedSlotStyle := false }}
        {{- with $slot.style }}
          {{- $mergedSlotStyle = partial "vitae/_functions/style-class" (dict
            "Style" .
            "ValidStyles" $validStyles
            "Template" $template
          ) -}}
          {{- if $debug }}
            {{- warnf "%s[%s]: After style-class:\nmergedSlotStyle=%v" $page $template
                (jsonify (dict "indent" "  ") $mergedSlotStyle) }}
          {{- end }}
          {{- with $mergedSlotStyle.StyleClass }}
            {{- $containerClass = append . $containerClass }}
          {{- end }}
        {{- end }}
        {{ printf `<%s class="%s" %s="%d" %s="%s">` $container
        (delimit $containerClass ` `)
        $pp.PaginationOrderAttr $paginationOrder
        $pp.PaginationPolicyAttr $paginationPolicy | safeHTML }}
      {{- end }}
      {{- $childClass := default "" .child_class }}
      {{- partial "vitae/_components/index" (merge $pp (dict
        "Page" $page
        "Config" $vitaeTemplate
        "MergedStyle" $mergedStyle
        "MergedStyleNew" $mergedStyleNew
        "ChildClass" $childClass
        "Data" $vitaeData
        "Sections" $slot.sections
        "SectionSeparator" "section-gap_vertical"
      )) -}}
      {{- with $container }}
        {{ printf `</%s>` . | safeHTML }}
      {{- end }}
    {{- end }}
  </div>
{{- end }}
{{ partial "html-comment" (printf "END   '%s'" $template) }}
